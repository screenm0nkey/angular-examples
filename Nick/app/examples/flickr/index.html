<!DOCTYPE html>
<html lang="en" ng-app="app">

<head>
  <style>
  img {width: 50px; height:50px; float:left;}
  .clear {clear:both;}
  </style>
</head>

<body>
  <div ng-controller="MyController">
    <flickr></flickr>
  </div>

  <script src="/lib/angular/angular.js"></script>
  <script src="/lib/underscore.js"></script>
  <script>

  var app =  angular.module("app", [])
  app.controller("MyController", function($scope) {
  });

  app.directive('flickr', function ($http, $log, $q) {
    return {
      restrict : 'E',
      replace  : true,
      scope : {},
      templateUrl : 'template.html',

      link : function ($scope, element, attrs, controller) {
        var canceler;
        $scope.getJSON = function (search) {
          // set up a dummy canceler

          var url1 = "http://www.flickr.com/services/feeds/photos_public.gne?tags="+search+"&format=json&per_page=10&jsoncallback=JSON_CALLBACK"

          var xhr = $http({method: 'JSONP', url: url1});
          // xhr = $http.jsonp(url1);
          // then gets the same data as success but in one object
          xhr.then(function (obj) {
            $log.log(obj)
            $scope.items = obj.data.items;
          })
        }

        $scope.terry = '';
        $scope.$watch('terry', function(newV, oldV) {
          if (newV && newV !== oldV && newV.length >=3) {
            console.log(newV);
            $scope.getJSON(newV);
          }
        });




      }
    }
  });
  </script>

</body>

</html>