<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>ngmodel $render</title>
</head>

<body ng-app="app">
  <div ng-init="amount=10"></div>

  <bank ng-model="amount"></bank>
  <hr>
  <input type="text" ng-model="amount">
  <hr>
  <button ng-click="amount=0">Reset</button>

  <script src="/lib/angular/angular.js"></script>
  <script type="text/javascript">
    var app = angular.module("app", []);

    app.directive('bank', function($filter) {
      return {
        restrict: 'E',
        template : '<div>Click to deposit $10</div>',
        require: 'ngModel',
        link: function(scope, element, attr, ngModel) {
          // $formatters  are formatting data going from Model to View
          ngModel.$formatters.push($filter('currency', 'Â£'));

          // Called when the view needs to be updated. It is expected that the
          // user of the ng-model directive will implement this method.
          // ngmodel does not do a deep watch.
          ngModel.$render = function () {
            console.log(ngModel);
            element.text('you now have ' + ngModel.$viewValue);
          };

        }
      };
    });

  </script>
</body>
</html>